<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ieHRMS Web User Feedback Form</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
            color: #2d3748;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navigation Bar */
        .navbar {
            background-color: #2c5282; /* Solid blue */
            color: white;
            padding: 18px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-brand i {
            font-size: 1.8rem;
            color: #48bb78; /* Green accent */
        }

        .nav-brand h1 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .nav-progress {
            flex: 1;
            max-width: 300px;
        }

        .progress-container {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar .progress-fill {
            height: 100%;
            background-color: #48bb78; /* Solid green */
            width: 0%;
            transition: width 0.5s ease;
        }

        #progressText {
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
        }

        /* Main Survey Area */
        .survey-main {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-top: 25px;
            overflow: hidden;
        }

        /* Module Indicator */
        .module-indicator {
            background-color: #ebf8ff; /* Light blue */
            padding: 25px 30px;
            border-bottom: 3px solid #2c5282; /* Solid blue border */
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .module-info h2 {
            color: #2d3748;
            font-size: 1.6rem;
            margin-bottom: 10px;
        }

        .module-tag {
            background-color: #2c5282; /* Solid blue */
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .module-tag i {
            font-size: 1rem;
        }

        .question-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 250px;
        }

        .question-progress .progress-bar {
            flex: 1;
            height: 8px;
            background-color: #cbd5e0;
            border-radius: 4px;
        }

        .question-progress .progress-fill {
            background-color: #48bb78; /* Solid green */
        }

        #questionCounter {
            color: #2c5282;
            font-weight: 500;
            font-size: 0.9rem;
            min-width: 100px;
            text-align: right;
        }

        /* Questions Container */
        .questions-container {
            min-height: 500px;
            padding: 40px 30px;
        }

        /* Welcome Screen */
        .welcome-screen {
            animation: fadeIn 0.8s ease;
        }

        .welcome-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .welcome-icon {
            width: 100px;
            height: 100px;
            background-color: #2c5282; /* Solid blue */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            box-shadow: 0 8px 25px rgba(44, 82, 130, 0.3);
        }

        .welcome-icon i {
            color: white;
            font-size: 3rem;
        }

        .welcome-content h2 {
            color: #2c5282; /* Solid blue */
            font-size: 2.2rem;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .welcome-content p {
            color: #4a5568;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .start-action {
            margin-top: 50px;
        }

        .start-btn {
            background-color: #48bb78; /* Solid green */
            color: white;
            border: none;
            border-radius: 50px;
            padding: 18px 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
        }

        .start-btn:hover {
            background-color: #38a169; /* Darker green */
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(72, 187, 120, 0.6);
        }

        .time-estimate {
            margin-top: 15px;
            color: #718096;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Question Styles */
        .question-container {
            animation: slideIn 0.5s ease;
            max-width: 800px;
            margin: 0 auto;
        }

        .question-text {
            font-size: 1.6rem;
            color: #2c5282; /* Blue */
            margin-bottom: 35px;
            line-height: 1.5;
            font-weight: 500;
            padding: 0 10px;
        }

        .answer-options {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option-btn {
            background-color: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px 25px;
            color: #2d3748;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .option-btn:hover {
            border-color: #48bb78; /* Green */
            background-color: #f0fff4;
        }

        .option-btn.selected {
            border-color: #2c5282; /* Blue */
            background-color: #ebf8ff;
            color: #2c5282;
            font-weight: 500;
        }

        .option-btn.selected:before {
            content: "âœ“";
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #48bb78; /* Green */
            font-size: 1.5rem;
            font-weight: bold;
        }

        .option-btn i {
            font-size: 1.3rem;
            width: 28px;
            text-align: center;
        }

        .option-btn.yes-btn.selected i {
            color: #48bb78; /* Green */
        }

        .option-btn.no-btn.selected i {
            color: #f56565; /* Red for No */
        }

        .answer-input {
            width: 100%;
            padding: 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            background-color: #f7fafc;
        }

        .answer-input:focus {
            outline: none;
            border-color: #2c5282; /* Blue */
            background-color: white;
        }

        .long-text-input {
            min-height: 150px;
            resize: vertical;
        }

        /* Rating Question */
        .rating-question {
            text-align: center;
            padding: 20px;
        }

        .rating-question p {
            color: #4a5568;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .rating-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }

        .rating-emoji {
            font-size: 4rem;
            transition: transform 0.3s ease;
        }

        .rating-value {
            font-size: 2.5rem;
            color: #2c5282; /* Blue */
            font-weight: bold;
            min-width: 60px;
        }

        .rating-slider {
            width: 100%;
            max-width: 500px;
            height: 12px;
            margin: 20px auto;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #f56565, #ed8936, #ecc94b, #48bb78, #38a169);
            border-radius: 6px;
            outline: none;
        }

        .rating-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: white;
            border: 3px solid #2c5282; /* Blue border */
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .rating-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            border-color: #48bb78; /* Green on hover */
        }

        .rating-labels {
            display: flex;
            justify-content: space-between;
            max-width: 500px;
            margin: 15px auto 0;
            font-size: 0.9rem;
            color: #718096;
            text-align: center;
        }

        .rating-labels span {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        /* Navigation Buttons */
        .navigation-buttons {
            padding: 25px 30px;
            border-top: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .btn {
            padding: 16px 35px;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            border: none;
        }

        .prev-btn {
            background-color: #f7fafc;
            border: 2px solid #e2e8f0;
            color: #2c5282; /* Blue */
        }

        .prev-btn:hover:not(:disabled) {
            background-color: #ebf8ff;
            border-color: #2c5282;
        }

        .next-btn {
            background-color: #2c5282; /* Solid blue */
            color: white;
        }

        .next-btn:hover:not(:disabled) {
            background-color: #2b6cb0;
            transform: translateX(3px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Database Status */
        .database-status {
            padding: 20px 30px;
            border-top: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f7fafc;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }

        .status-indicator i {
            font-size: 1.2rem;
        }

        .status-indicator.connected i {
            color: #48bb78; /* Green */
        }

        .status-indicator.disconnected i {
            color: #f56565; /* Red */
        }

        .response-count {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #718096;
            font-size: 0.95rem;
        }

        .response-count i {
            color: #2c5282; /* Blue */
        }

        /* Completion Screen */
        .completion-screen {
            text-align: center;
            padding: 50px 30px;
            animation: fadeIn 0.8s ease;
        }

        .completion-icon {
            width: 120px;
            height: 120px;
            background-color: #48bb78; /* Solid green */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            box-shadow: 0 10px 30px rgba(72, 187, 120, 0.4);
        }

        .completion-icon i {
            color: white;
            font-size: 3.5rem;
        }

        .completion-screen h2 {
            color: #2c5282; /* Blue */
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .completion-screen p {
            color: #4a5568;
            font-size: 1.2rem;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto 30px;
        }

        .submission-details {
            background-color: #f7fafc;
            border-radius: 15px;
            padding: 25px;
            margin: 30px auto;
            max-width: 500px;
            border: 2px solid #e2e8f0;
        }

        .submission-details h3 {
            color: #2c5282; /* Blue */
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .detail-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .detail-label {
            color: #718096;
        }

        .detail-value {
            color: #2c5282; /* Blue */
            font-weight: 500;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .nav-progress {
                width: 100%;
                max-width: 100%;
            }
            
            .module-indicator {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .question-progress {
                width: 100%;
            }
            
            .question-text {
                font-size: 1.4rem;
            }
            
            .option-btn {
                padding: 16px 20px;
                font-size: 1rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .questions-container {
                padding: 25px 20px;
            }
            
            .welcome-content h2 {
                font-size: 1.8rem;
            }
            
            .question-text {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-chart-line"></i>
                <h1>ieHRMS Web User Feedback Form</h1>
            </div>
            <div class="nav-progress">
                <div class="progress-container">
                    <div class="progress-bar" id="overallProgressBar"></div>
                    <span id="progressText">0% Complete</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <main class="survey-main">
            <!-- Current Module Indicator -->
            <div class="module-indicator">
                <div class="module-info">
                    <h2 id="currentModuleTitle">Welcome</h2>
                    <div class="module-tag" id="moduleTag">
                        <i class="fas fa-user-tie"></i>
                        <span id="moduleName">Recruitment Module</span>
                    </div>
                </div>
                <div class="question-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="moduleProgress"></div>
                    </div>
                    <span id="questionCounter">Question 0/0</span>
                </div>
            </div>

            <!-- Questions Container -->
            <div class="questions-container" id="questionsContainer">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-content">
                        <div class="welcome-icon">
                            <i class="fas fa-comment-alt"></i>
                        </div>
                        <h2>Welcome to ieHRMS User Feedback Survey</h2>
                        <p>Your feedback helps us improve all modules of ieHRMS web application. This survey will guide you through each module automatically.</p>

                        <div class="start-action">
                            <button class="btn start-btn" id="startSurveyBtn">
                                <i class="fas fa-play"></i> Start Survey
                            </button>
                            <p class="time-estimate">
                                <i class="fas fa-clock"></i> Estimated time: 25-35 minutes
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="navigation-buttons" id="navigationButtons" style="display: none;">
                <button class="btn prev-btn" id="prevBtn">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn next-btn" id="nextBtn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <!-- Database Status -->
            <div class="database-status">
                <div class="status-indicator" id="statusIndicator">
                    <i class="fas fa-database" id="dbIcon"></i>
                    <span id="dbStatusText">Ready to start</span>
                </div>
                <div class="response-count">
                    <i class="fas fa-save"></i>
                    <span>Saved: <span id="savedCount">0</span></span>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Complete Survey Data with Sequential Flow - EXACTLY MATCHING EXCEL
        const surveyData = [
            {
                id: "recruitment",
                name: "Recruitment Module",
                icon: "fa-user-tie",
                questions: [
                    {
                        id: "1.0",
                        text: "Have You Used the Recruitment Module in ieHRMS web?",
                        type: "yesno",
                        skipLogic: {
                            ifNo: "skipModule"
                        }
                    },
                    {
                        id: "1.0-no",
                        text: "If answer to Qno. 1 = No then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "1.0",
                        showIf: "No"
                    },
                    {
                        id: "1.1",
                        text: "Have You Used the new All Application Candidate page?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "1.0",
                        showIf: "Yes"
                    },
                    {
                        id: "1.1-no",
                        text: "If answer to Qno. 1.1 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "1.1",
                        showIf: "No"
                    },
                    {
                        id: "1.1-rating",
                        text: "If answer to Qno. 1.1 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "1.1",
                        showIf: "Yes"
                    },
                    {
                        id: "1.1-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "1.1",
                        showIf: "Yes"
                    },
                    {
                        id: "1.1-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "1.1",
                        showIf: "Yes"
                    },
                    {
                        id: "1.2",
                        text: "Have you created any Posts in ieHRMS web using Post Creation menu?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "1.0",
                        showIf: "Yes"
                    },
                    {
                        id: "1.2-no",
                        text: "If answer to Qno. 1.2 = No then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "1.2",
                        showIf: "No"
                    },
                    {
                        id: "1.2-rating",
                        text: "If answer to Qno. 1.2 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "1.2",
                        showIf: "Yes"
                    },
                    {
                        id: "1.2-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "1.2",
                        showIf: "Yes"
                    },
                    {
                        id: "1.2-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "1.2",
                        showIf: "Yes"
                    },
                    {
                        id: "1.3",
                        text: "Have You Used the Recruitment Tracker Feature in ieHRMS web?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "1.0",
                        showIf: "Yes"
                    },
                    {
                        id: "1.3-no",
                        text: "If answer to Qno. 1.3 = No then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "1.3",
                        showIf: "No"
                    },
                    {
                        id: "1.3-rating",
                        text: "If answer to Qno. 1.3 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "1.3",
                        showIf: "Yes"
                    },
                    {
                        id: "1.3-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "1.3",
                        showIf: "Yes"
                    },
                    {
                        id: "1.3-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "1.3",
                        showIf: "Yes"
                    },
                    {
                        id: "1.4",
                        text: "Have You Used the Applicant Tracking System (ATS) in ieHRMS web?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "1.0",
                        showIf: "Yes"
                    },
                    {
                        id: "1.4-no",
                        text: "If answer to Qno. 1.4 = No then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "1.4",
                        showIf: "No"
                    },
                    {
                        id: "1.4-rating",
                        text: "If answer to Qno. 1.4 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "1.4",
                        showIf: "Yes"
                    },
                    {
                        id: "1.4-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "1.4",
                        showIf: "Yes"
                    },
                    {
                        id: "1.4-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "1.4",
                        showIf: "Yes"
                    }
                ]
            },
            {
                id: "essp",
                name: "ESSP Module",
                icon: "fa-users",
                questions: [
                    {
                        id: "2.0",
                        text: "Have You Used the ESSP Module in ieHRMS web?",
                        type: "yesno",
                        skipLogic: {
                            ifNo: "skipModule"
                        }
                    },
                    {
                        id: "2.0-no",
                        text: "If answer to Qno. 2 = No then, Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "2.0",
                        showIf: "No"
                    },
                    {
                        id: "2.1",
                        text: "Have You taken any Online Tests / Surveys on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "2.0",
                        showIf: "Yes"
                    },
                    {
                        id: "2.1-no",
                        text: "If answer to Qno. 2.1 = No, then. Why?",
                        type: "mcq",
                        options: ["No Tests or Surveys were ever assigned to me", "I did that on the mobile app version", "Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "2.1",
                        showIf: "No"
                    },
                    {
                        id: "2.1-rating",
                        text: "If answer to Qno. 2.1 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "2.1",
                        showIf: "Yes"
                    },
                    {
                        id: "2.1-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "2.1",
                        showIf: "Yes"
                    },
                    {
                        id: "2.1-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "2.1",
                        showIf: "Yes"
                    },
                    {
                        id: "2.2",
                        text: "Have You made any leave applications / cancelled leave applications on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "2.0",
                        showIf: "Yes"
                    },
                    {
                        id: "2.2-no",
                        text: "If answer to Qno. 2.2 = No, then. Why?",
                        type: "mcq",
                        options: ["I did that on the mobile app version", "Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "2.2",
                        showIf: "No"
                    },
                    {
                        id: "2.2-rating",
                        text: "If answer to Qno. 2.2 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "2.2",
                        showIf: "Yes"
                    },
                    {
                        id: "2.2-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "2.2",
                        showIf: "Yes"
                    },
                    {
                        id: "2.2-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "2.2",
                        showIf: "Yes"
                    },
                    {
                        id: "2.3",
                        text: "Have You made any loan/advance applications on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "2.0",
                        showIf: "Yes"
                    },
                    {
                        id: "2.3-no",
                        text: "If answer to Qno. 2.3 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "2.3",
                        showIf: "No"
                    },
                    {
                        id: "2.3-rating",
                        text: "If answer to Qno. 2.3 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "2.3",
                        showIf: "Yes"
                    },
                    {
                        id: "2.3-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "2.3",
                        showIf: "Yes"
                    },
                    {
                        id: "2.3-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "2.3",
                        showIf: "Yes"
                    },
                    {
                        id: "2.4",
                        text: "Have used any of the ESSP Admin features on web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "2.0",
                        showIf: "Yes"
                    },
                    {
                        id: "2.4-no",
                        text: "If answer to Qno. 2.4 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "2.4",
                        showIf: "No"
                    },
                    {
                        id: "2.4-rating",
                        text: "If answer to Qno. 2.4 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "2.4",
                        showIf: "Yes"
                    },
                    {
                        id: "2.4-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "2.4",
                        showIf: "Yes"
                    },
                    {
                        id: "2.4-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "2.4",
                        showIf: "Yes"
                    }
                ]
            },
            {
                id: "mjl",
                name: "MJL Module",
                icon: "fa-tasks",
                questions: [
                    {
                        id: "3.0",
                        text: "Have You Used the MJL Module in ieHRMS web?",
                        type: "yesno",
                        skipLogic: {
                            ifNo: "skipModule"
                        }
                    },
                    {
                        id: "3.0-no",
                        text: "If answer to Qno. 3 = No then, Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "3.0",
                        showIf: "No"
                    },
                    {
                        id: "3.1",
                        text: "Have You created any MJLs on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "3.0",
                        showIf: "Yes"
                    },
                    {
                        id: "3.1-no",
                        text: "If answer to Qno. 3.1 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "3.1",
                        showIf: "No"
                    },
                    {
                        id: "3.1-rating",
                        text: "If answer to Qno. 3.1 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "3.1",
                        showIf: "Yes"
                    },
                    {
                        id: "3.1-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "3.1",
                        showIf: "Yes"
                    },
                    {
                        id: "3.2",
                        text: "Have You created any SOPs on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "3.0",
                        showIf: "Yes"
                    },
                    {
                        id: "3.2-no",
                        text: "If answer to Qno. 3.2 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "3.2",
                        showIf: "No"
                    },
                    {
                        id: "3.2-rating",
                        text: "If answer to Qno. 3.2 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "3.2",
                        showIf: "Yes"
                    },
                    {
                        id: "3.2-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "3.2",
                        showIf: "Yes"
                    },
                    {
                        id: "3.3",
                        text: "Do you have any suggestion for the MJL Dashboard? (Only if Applicable to you)",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "3.0",
                        showIf: "Yes"
                    }
                ]
            },
            {
                id: "employeeProfile",
                name: "Employee Profile",
                icon: "fa-id-card",
                questions: [
                    {
                        id: "4.0",
                        text: "Have You Used the Employee profile Module in ieHRMS web?",
                        type: "yesno",
                        skipLogic: {
                            ifNo: "skipModule"
                        }
                    },
                    {
                        id: "4.0-no",
                        text: "If answer to Qno. 4 = No then, Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "It's not relevant to me", "I prefer the Mobile App version for that"],
                        conditional: true,
                        dependsOn: "4.0",
                        showIf: "No"
                    },
                    {
                        id: "4.1",
                        text: "Have You used the Candidate profile page on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "4.0",
                        showIf: "Yes"
                    },
                    {
                        id: "4.1-no",
                        text: "If answer to Qno. 4.1 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "4.1",
                        showIf: "No"
                    },
                    {
                        id: "4.1-rating",
                        text: "If answer to Qno. 4.1 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "4.1",
                        showIf: "Yes"
                    },
                    {
                        id: "4.1-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "4.1",
                        showIf: "Yes"
                    },
                    {
                        id: "4.1-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "4.1",
                        showIf: "Yes"
                    },
                    {
                        id: "4.2",
                        text: "Have You used the Employee Profile profile page on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "4.0",
                        showIf: "Yes"
                    },
                    {
                        id: "4.2-no",
                        text: "If answer to Qno. 4.2 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "4.2",
                        showIf: "No"
                    },
                    {
                        id: "4.2-rating",
                        text: "If answer to Qno. 4.2 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "4.2",
                        showIf: "Yes"
                    },
                    {
                        id: "4.2-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "4.2",
                        showIf: "Yes"
                    },
                    {
                        id: "4.2-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "4.2",
                        showIf: "Yes"
                    },
                    {
                        id: "4.3",
                        text: "Have You used the Candidate Document List on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "4.0",
                        showIf: "Yes"
                    },
                    {
                        id: "4.3-no",
                        text: "If answer to Qno. 4.3 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "4.3",
                        showIf: "No"
                    },
                    {
                        id: "4.3-rating",
                        text: "If answer to Qno. 4.3 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "4.3",
                        showIf: "Yes"
                    },
                    {
                        id: "4.3-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "4.3",
                        showIf: "Yes"
                    },
                    {
                        id: "4.3-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "4.3",
                        showIf: "Yes"
                    },
                    {
                        id: "4.4",
                        text: "Have You used the Employee Document List on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "4.0",
                        showIf: "Yes"
                    },
                    {
                        id: "4.4-no",
                        text: "If answer to Qno. 4.4 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "4.4",
                        showIf: "No"
                    },
                    {
                        id: "4.4-rating",
                        text: "If answer to Qno. 4.4 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "4.4",
                        showIf: "Yes"
                    },
                    {
                        id: "4.4-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "4.4",
                        showIf: "Yes"
                    },
                    {
                        id: "4.4-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "4.4",
                        showIf: "Yes"
                    }
                ]
            },
            {
                id: "leave",
                name: "Leave Module",
                icon: "fa-umbrella-beach",
                questions: [
                    {
                        id: "5.0",
                        text: "Have You Used the Leave Module in ieHRMS web?",
                        type: "yesno",
                        skipLogic: {
                            ifNo: "skipModule"
                        }
                    },
                    {
                        id: "5.0-no",
                        text: "If answer to Qno. 5 = No then, Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "It's not relevant to me", "I prefer the Mobile App version for that"],
                        conditional: true,
                        dependsOn: "5.0",
                        showIf: "No"
                    },
                    {
                        id: "5.1",
                        text: "Have You used the Leave Request menu on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "5.0",
                        showIf: "Yes"
                    },
                    {
                        id: "5.1-no",
                        text: "If answer to Qno. 5.1 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "5.1",
                        showIf: "No"
                    },
                    {
                        id: "5.1-rating",
                        text: "If answer to Qno. 5.1 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "5.1",
                        showIf: "Yes"
                    },
                    {
                        id: "5.1-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "5.1",
                        showIf: "Yes"
                    },
                    {
                        id: "5.1-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "5.1",
                        showIf: "Yes"
                    },
                    {
                        id: "5.2",
                        text: "Have You used the Leave Master menu on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "5.0",
                        showIf: "Yes"
                    },
                    {
                        id: "5.2-no",
                        text: "If answer to Qno. 5.2 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "5.2",
                        showIf: "No"
                    },
                    {
                        id: "5.2-rating",
                        text: "If answer to Qno. 5.2 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "5.2",
                        showIf: "Yes"
                    },
                    {
                        id: "5.2-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "5.2",
                        showIf: "Yes"
                    },
                    {
                        id: "5.2-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "5.2",
                        showIf: "Yes"
                    },
                    {
                        id: "5.3",
                        text: "Have You used the Leave Application menu on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "5.0",
                        showIf: "Yes"
                    },
                    {
                        id: "5.3-no",
                        text: "If answer to Qno. 5.3 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "5.3",
                        showIf: "No"
                    },
                    {
                        id: "5.3-rating",
                        text: "If answer to Qno. 5.3 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "5.3",
                        showIf: "Yes"
                    },
                    {
                        id: "5.3-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "5.3",
                        showIf: "Yes"
                    },
                    {
                        id: "5.3-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "5.3",
                        showIf: "Yes"
                    },
                    {
                        id: "5.4",
                        text: "Have You used the Attendance menu on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "5.0",
                        showIf: "Yes"
                    },
                    {
                        id: "5.4-no",
                        text: "If answer to Qno. 5.4 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "5.4",
                        showIf: "No"
                    },
                    {
                        id: "5.4-rating",
                        text: "If answer to Qno. 5.4 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "5.4",
                        showIf: "Yes"
                    },
                    {
                        id: "5.4-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "5.4",
                        showIf: "Yes"
                    },
                    {
                        id: "5.4-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "5.4",
                        showIf: "Yes"
                    },
                    {
                        id: "5.5",
                        text: "Do you have any suggestion for the Leave Module Dashboard?",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "5.0",
                        showIf: "Yes"
                    }
                ]
            },
            {
                id: "psychometric",
                name: "Psychometric Module",
                icon: "fa-brain",
                questions: [
                    {
                        id: "6.0",
                        text: "Have You Used the Psychometric Module in ieHRMS web?",
                        type: "yesno",
                        skipLogic: {
                            ifNo: "skipModule"
                        }
                    },
                    {
                        id: "6.0-no",
                        text: "If answer to Qno. 6 = No then, Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "It's not relevant to me", "I prefer the Mobile App version for that"],
                        conditional: true,
                        dependsOn: "6.0",
                        showIf: "No"
                    },
                    {
                        id: "6.1",
                        text: "Have You used this module to assign test to employees on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "6.0",
                        showIf: "Yes"
                    },
                    {
                        id: "6.1-no",
                        text: "If answer to Qno. 6.1 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "6.1",
                        showIf: "No"
                    },
                    {
                        id: "6.1-rating",
                        text: "If answer to Qno. 6.1 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "6.1",
                        showIf: "Yes"
                    },
                    {
                        id: "6.1-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "6.1",
                        showIf: "Yes"
                    },
                    {
                        id: "6.1-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "6.1",
                        showIf: "Yes"
                    },
                    {
                        id: "6.2",
                        text: "Have You used this module to check Psychometric reports of Candidates / Employee / Educyte Trainee on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "6.0",
                        showIf: "Yes"
                    },
                    {
                        id: "6.2-no",
                        text: "If answer to Qno. 6.2 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "6.2",
                        showIf: "No"
                    },
                    {
                        id: "6.2-rating",
                        text: "If answer to Qno. 6.2 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "6.2",
                        showIf: "Yes"
                    },
                    {
                        id: "6.2-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "6.2",
                        showIf: "Yes"
                    },
                    {
                        id: "6.2-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "6.2",
                        showIf: "Yes"
                    },
                    {
                        id: "6.3",
                        text: "Have You used this module to create surveys on the web version of ieHRMS?",
                        type: "yesno",
                        conditional: true,
                        dependsOn: "6.0",
                        showIf: "Yes"
                    },
                    {
                        id: "6.3-no",
                        text: "If answer to Qno. 6.3 = No, then. Why?",
                        type: "mcq",
                        options: ["Did not like the layout", "It is very complex to use", "No one told me about it", "It's not relevant to me"],
                        conditional: true,
                        dependsOn: "6.3",
                        showIf: "No"
                    },
                    {
                        id: "6.3-rating",
                        text: "If answer to Qno. 6.3 = Yes, then. How much would you rate it out of 5?",
                        type: "rating",
                        conditional: true,
                        dependsOn: "6.3",
                        showIf: "Yes"
                    },
                    {
                        id: "6.3-favorite",
                        text: "What are your most and least favourite things about this?",
                        type: "text",
                        conditional: true,
                        dependsOn: "6.3",
                        showIf: "Yes"
                    },
                    {
                        id: "6.3-suggestions",
                        text: "Any suggestions / message for the developer",
                        type: "longtext",
                        conditional: true,
                        dependsOn: "6.3",
                        showIf: "Yes"
                    }
                ]
            }
        ];

        // Survey State
        let surveyState = {
            currentModuleIndex: 0,
            currentQuestionIndex: 0,
            answers: {},
            savedToDatabase: 0,
            sessionId: generateSessionId(),
            useLocalStorage: false,
            isFirstQuestionOfModule: true
        };

        // YOUR SUPABASE CREDENTIALS
        const SUPABASE_URL = 'https://erixafnalqakldvkscue.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyaXhhZm5hbHFha2xkdmtzY3VlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0NzE3MDAsImV4cCI6MjA4NDA0NzcwMH0.S42M4MvFYiI8ns_p60GIpbPD7N5yi7mdOGsmx78QqCc';

        let supabaseClient = null;

        // Generate unique session ID
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // DOM Elements
        const elements = {
            overallProgressBar: document.getElementById('overallProgressBar'),
            progressText: document.getElementById('progressText'),
            
            currentModuleTitle: document.getElementById('currentModuleTitle'),
            moduleName: document.getElementById('moduleName'),
            moduleProgress: document.getElementById('moduleProgress'),
            questionCounter: document.getElementById('questionCounter'),
            
            questionsContainer: document.getElementById('questionsContainer'),
            welcomeScreen: document.getElementById('welcomeScreen'),
            startSurveyBtn: document.getElementById('startSurveyBtn'),
            navigationButtons: document.getElementById('navigationButtons'),
            
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            
            statusIndicator: document.getElementById('statusIndicator'),
            dbIcon: document.getElementById('dbIcon'),
            dbStatusText: document.getElementById('dbStatusText'),
            savedCount: document.getElementById('savedCount')
        };

        // Initialize the survey
        function initSurvey() {
            console.log('Initializing survey with session:', surveyState.sessionId);
            
            // Initialize answers for all modules
            surveyData.forEach(module => {
                if (!surveyState.answers[module.id]) {
                    surveyState.answers[module.id] = {};
                }
            });
            
            // Initialize Supabase
            initSupabase();
            
            // Update UI
            updateProgress();
            updateModuleHeader();
            
            // Setup event listeners
            setupEventListeners();
        }

        // Initialize Supabase
        function initSupabase() {
            try {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('Supabase client initialized');
                
                // Test connection
                testDatabaseConnection();
            } catch (error) {
                console.error('Error initializing Supabase:', error);
                fallbackToLocalStorage('Initialization error');
            }
        }

        // Test database connection
        async function testDatabaseConnection() {
            if (!supabaseClient) {
                fallbackToLocalStorage('Supabase not initialized');
                return;
            }
            
            try {
                updateDatabaseStatus(false, 'Testing connection...');
                
                const { data, error } = await supabaseClient
                    .from('survey_responses')
                    .select('id')
                    .limit(1)
                    .maybeSingle();
                
                if (error && error.message.includes('does not exist')) {
                    console.log('Table does not exist. Creating it automatically...');
                    await createSurveyTable();
                } else if (error) {
                    console.error('Connection test failed:', error);
                    fallbackToLocalStorage('Connection failed');
                } else {
                    console.log('âœ… Connected to Supabase!');
                    updateDatabaseStatus(true, 'Connected to database');
                }
                
            } catch (error) {
                console.error('Connection test exception:', error);
                fallbackToLocalStorage('Connection error');
            }
        }

        // Create survey table if it doesn't exist
        async function createSurveyTable() {
            try {
                // Try to insert a test record - Supabase will create table automatically if enabled
                const { error } = await supabaseClient
                    .from('survey_responses')
                    .insert({
                        session_id: 'test_' + Date.now(),
                        module: 'test',
                        question_id: 'test',
                        answer: 'test',
                        timestamp: new Date().toISOString()
                    });
                
                if (error) {
                    console.log('Auto-create failed. Please create table manually in Supabase.');
                    alert('Please create the "survey_responses" table in Supabase Table Editor.');
                } else {
                    console.log('Table created/verified successfully');
                    updateDatabaseStatus(true, 'Database ready');
                }
            } catch (error) {
                console.log('Table creation check failed:', error);
            }
        }

        // Fallback to local storage
        function fallbackToLocalStorage(reason) {
            console.log('Falling back to local storage:', reason);
            surveyState.useLocalStorage = true;
            updateDatabaseStatus(false, 'Using local storage');
            
            // Show notification
            showNotification('âš ï¸ Using local storage. ' + reason, 'warning');
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'warning' ? '#fff3cd' : '#d1ecf1'};
                border: 1px solid ${type === 'warning' ? '#ffeaa7' : '#bee5eb'};
                color: ${type === 'warning' ? '#856404' : '#0c5460'};
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                z-index: 9999;
                display: flex;
                align-items: center;
                gap: 10px;
                max-width: 400px;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Update database status display
        function updateDatabaseStatus(connected = false, message = '') {
            if (!elements.statusIndicator || !elements.dbIcon || !elements.dbStatusText) return;
            
            if (connected) {
                elements.statusIndicator.className = 'status-indicator connected';
                elements.dbIcon.className = 'fas fa-database';
                elements.dbStatusText.textContent = message || 'Connected';
                elements.dbIcon.style.color = '#48bb78';
            } else {
                elements.statusIndicator.className = 'status-indicator disconnected';
                elements.dbIcon.className = 'fas fa-exclamation-triangle';
                elements.dbStatusText.textContent = message || 'Not connected';
                elements.dbIcon.style.color = surveyState.useLocalStorage ? '#ed8936' : '#f56565';
            }
        }

        // Save answer to database or local storage
        async function saveCurrentAnswerToDatabase(questionId, answer) {
            const module = surveyData[surveyState.currentModuleIndex];
            
            // Save to state
            saveAnswer(questionId, answer);
            
            // Save to storage
            if (surveyState.useLocalStorage) {
                saveToLocalStorage(questionId, answer);
            } else {
                await saveToSupabase(questionId, answer);
            }
        }

        // Save to Supabase
        async function saveToSupabase(questionId, answer) {
            if (!supabaseClient) return;
            
            try {
                const { data, error } = await supabaseClient
                    .from('survey_responses')
                    .insert([
                        {
                            session_id: surveyState.sessionId,
                            module: surveyData[surveyState.currentModuleIndex].id,
                            question_id: questionId,
                            answer: answer,
                            timestamp: new Date().toISOString()
                        }
                    ]);
                
                if (error) {
                    console.error('Supabase save error:', error);
                    // Don't fallback immediately - just log error
                    updateDatabaseStatus(false, 'Save error');
                    return;
                }
                
                // Success
                surveyState.savedToDatabase++;
                if (elements.savedCount) {
                    elements.savedCount.textContent = surveyState.savedToDatabase;
                }
                
                updateDatabaseStatus(true, 'Saved to database');
                
            } catch (error) {
                console.error('Exception when saving:', error);
                updateDatabaseStatus(false, 'Save failed');
            }
        }

        // Save to local storage
        function saveToLocalStorage(questionId, answer) {
            const module = surveyData[surveyState.currentModuleIndex];
            
            try {
                const storageKey = `iehrms_survey_${surveyState.sessionId}`;
                let allData = JSON.parse(localStorage.getItem(storageKey)) || {};
                
                if (!allData[module.id]) {
                    allData[module.id] = {};
                }
                
                allData[module.id][questionId] = {
                    answer: answer,
                    timestamp: new Date().toISOString(),
                    saved_locally: true
                };
                
                localStorage.setItem(storageKey, JSON.stringify(allData));
                
                surveyState.savedToDatabase++;
                if (elements.savedCount) {
                    elements.savedCount.textContent = surveyState.savedToDatabase;
                }
                
            } catch (error) {
                console.error('Local storage error:', error);
            }
        }

        // Start the survey
        function startSurvey() {
            console.log('Starting survey...');
            elements.welcomeScreen.style.display = 'none';
            elements.navigationButtons.style.display = 'flex';
            showCurrentQuestion();
        }

        // Show current question
        function showCurrentQuestion() {
            const module = surveyData[surveyState.currentModuleIndex];
            const question = module.questions[surveyState.currentQuestionIndex];
            
            if (!question) {
                // No more questions in this module
                moveToNextModule();
                return;
            }
            
            // Update UI
            updateModuleHeader();
            
            // Check if this question should be shown
            if (question.conditional) {
                const dependsOnAnswer = getAnswer(question.dependsOn);
                if (dependsOnAnswer !== question.showIf) {
                    // Skip this question
                    surveyState.currentQuestionIndex++;
                    showCurrentQuestion();
                    return;
                }
            }
            
            // Build question HTML
            let questionHtml = `
                <div class="question-container">
                    <div class="question-text">${question.text}</div>
                    <div class="answer-options" id="answerOptions">
            `;
            
            // Get saved answer
            const savedAnswer = getAnswer(question.id);
            
            // Add answer options based on type
            switch(question.type) {
                case "yesno":
                    questionHtml += `
                        <button class="option-btn yes-btn ${savedAnswer === 'Yes' ? 'selected' : ''}" data-value="Yes">
                            <i class="fas fa-check-circle"></i> Yes
                        </button>
                        <button class="option-btn no-btn ${savedAnswer === 'No' ? 'selected' : ''}" data-value="No">
                            <i class="fas fa-times-circle"></i> No
                        </button>
                    `;
                    break;
                    
                case "mcq":
                    question.options.forEach(option => {
                        questionHtml += `
                            <button class="option-btn ${savedAnswer === option ? 'selected' : ''}" data-value="${option}">
                                <i class="fas fa-circle"></i> ${option}
                            </button>
                        `;
                    });
                    break;
                    
                case "rating":
                    const rating = savedAnswer || 3;
                    questionHtml += `
                        <div class="rating-question">
                            <p>Please rate this feature on a scale of 1 to 5</p>
                            <div class="rating-display">
                                <div class="rating-emoji" id="ratingEmoji">${getEmojiForRating(rating)}</div>
                                <div class="rating-value" id="ratingValueDisplay">${rating}/5</div>
                            </div>
                            <input type="range" min="1" max="5" value="${rating}" class="rating-slider" id="ratingSlider">
                            <div class="rating-labels">
                                <span>1<br>ðŸ˜ž</span>
                                <span>2<br>ðŸ˜</span>
                                <span>3<br>ðŸ™‚</span>
                                <span>4<br>ðŸ˜Š</span>
                                <span>5<br>ðŸ¤©</span>
                            </div>
                        </div>
                    `;
                    break;
                    
                case "text":
                    questionHtml += `
                        <input type="text" class="answer-input" id="textAnswer" 
                               placeholder="Type your answer here..." 
                               value="${savedAnswer || ''}">
                    `;
                    break;
                    
                case "longtext":
                    questionHtml += `
                        <textarea class="answer-input long-text-input" id="longTextAnswer" 
                                  placeholder="Share your thoughts and suggestions...">${savedAnswer || ''}</textarea>
                    `;
                    break;
            }
            
            questionHtml += `</div></div>`;
            
            // Update questions container
            elements.questionsContainer.innerHTML = questionHtml;
            
            // Setup event listeners
            setupQuestionEventListeners(question);
            
            // Update navigation buttons
            updateNavigationButtons();
        }

        // Get emoji for rating
        function getEmojiForRating(rating) {
            const emojis = ["ðŸ˜ž", "ðŸ˜", "ðŸ™‚", "ðŸ˜Š", "ðŸ¤©"];
            return emojis[rating - 1] || "ðŸ˜";
        }

        // Setup event listeners for current question
        function setupQuestionEventListeners(question) {
            // Option buttons
            const optionButtons = document.querySelectorAll('.option-btn');
            optionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove selected class from all buttons
                    optionButtons.forEach(btn => btn.classList.remove('selected'));
                    
                    // Add selected class to clicked button
                    button.classList.add('selected');
                    
                    const answer = button.getAttribute('data-value');
                    
                    // Handle skip logic for first question of module
                    if (question.skipLogic && question.skipLogic.ifNo === 'skipModule') {
                        if (answer === 'No') {
                            // Mark all remaining questions as N/A and skip module
                            skipCurrentModule();
                            return;
                        }
                    }
                    
                    // Save answer
                    saveCurrentAnswerToDatabase(question.id, answer);
                    
                    // Auto-advance to next question
                    setTimeout(() => {
                        goToNextQuestion();
                    }, 300);
                });
            });
            
            // Text inputs
            const textInput = document.getElementById('textAnswer');
            if (textInput) {
                textInput.addEventListener('input', (e) => {
                    const answer = e.target.value;
                    saveCurrentAnswerToDatabase(question.id, answer);
                });
            }
            
            const longTextInput = document.getElementById('longTextAnswer');
            if (longTextInput) {
                longTextInput.addEventListener('input', (e) => {
                    const answer = e.target.value;
                    saveCurrentAnswerToDatabase(question.id, answer);
                });
            }
            
            // Rating slider
            const ratingSlider = document.getElementById('ratingSlider');
            if (ratingSlider) {
                ratingSlider.addEventListener('input', (e) => {
                    const rating = parseInt(e.target.value);
                    
                    // Update display
                    const emoji = getEmojiForRating(rating);
                    const valueDisplay = document.getElementById('ratingValueDisplay');
                    const emojiDisplay = document.getElementById('ratingEmoji');
                    
                    if (valueDisplay) valueDisplay.textContent = `${rating}/5`;
                    if (emojiDisplay) emojiDisplay.textContent = emoji;
                    
                    // Save answer
                    saveCurrentAnswerToDatabase(question.id, rating);
                });
            }
        }

        // Save answer to state
        function saveAnswer(questionId, answer) {
            const module = surveyData[surveyState.currentModuleIndex];
            if (!surveyState.answers[module.id]) {
                surveyState.answers[module.id] = {};
            }
            surveyState.answers[module.id][questionId] = answer;
            updateProgress();
        }

        // Get answer from state
        function getAnswer(questionId) {
            const module = surveyData[surveyState.currentModuleIndex];
            return surveyState.answers[module.id]?.[questionId];
        }

        // Skip current module (when user answers "No" to first question)
        function skipCurrentModule() {
            const module = surveyData[surveyState.currentModuleIndex];
            const currentQuestion = module.questions[surveyState.currentQuestionIndex];
            
            // Save the "No" answer
            saveCurrentAnswerToDatabase(currentQuestion.id, 'No');
            
            // Mark all remaining questions in this module as "N/A"
            for (let i = surveyState.currentQuestionIndex + 1; i < module.questions.length; i++) {
                const question = module.questions[i];
                saveCurrentAnswerToDatabase(question.id, 'N/A');
            }
            
            // Move to next module
            setTimeout(() => {
                moveToNextModule();
            }, 500);
        }

        // Move to next module
        function moveToNextModule() {
            if (surveyState.currentModuleIndex < surveyData.length - 1) {
                surveyState.currentModuleIndex++;
                surveyState.currentQuestionIndex = 0;
                showCurrentQuestion();
            } else {
                // All modules completed
                showCompletionScreen();
            }
        }

        // Go to next question
        function goToNextQuestion() {
            const module = surveyData[surveyState.currentModuleIndex];
            
            if (surveyState.currentQuestionIndex < module.questions.length - 1) {
                surveyState.currentQuestionIndex++;
                showCurrentQuestion();
            } else {
                // Last question in module, move to next module
                moveToNextModule();
            }
        }

        // Go to previous question
        function goToPreviousQuestion() {
            if (surveyState.currentQuestionIndex > 0) {
                surveyState.currentQuestionIndex--;
                showCurrentQuestion();
            } else if (surveyState.currentModuleIndex > 0) {
                // Go to previous module's last question
                surveyState.currentModuleIndex--;
                surveyState.currentQuestionIndex = surveyData[surveyState.currentModuleIndex].questions.length - 1;
                showCurrentQuestion();
            }
        }

        // Update module header
        function updateModuleHeader() {
            const module = surveyData[surveyState.currentModuleIndex];
            const currentQuestion = surveyState.currentQuestionIndex + 1;
            const totalQuestions = module.questions.length;
            
            elements.currentModuleTitle.textContent = `Module ${surveyState.currentModuleIndex + 1} of ${surveyData.length}`;
            elements.moduleName.textContent = module.name;
            elements.questionCounter.textContent = `Question ${currentQuestion}/${totalQuestions}`;
            
            // Update module progress
            const moduleAnswers = Object.keys(surveyState.answers[module.id] || {}).length;
            const moduleProgress = Math.round((moduleAnswers / totalQuestions) * 100);
            elements.moduleProgress.style.width = `${moduleProgress}%`;
        }

        // Update navigation buttons
        function updateNavigationButtons() {
            const module = surveyData[surveyState.currentModuleIndex];
            
            // Enable previous button if not on first question
            elements.prevBtn.disabled = surveyState.currentQuestionIndex === 0;
            
            // Get current question
            const currentQuestion = module.questions[surveyState.currentQuestionIndex];
            
            // For rating, text, and longtext questions, always enable next button
            if (currentQuestion.type === 'rating' || currentQuestion.type === 'text' || currentQuestion.type === 'longtext') {
                elements.nextBtn.disabled = false;
            } else {
                // For yesno and mcq, check if answered
                const isAnswered = currentQuestion && getAnswer(currentQuestion.id) !== undefined;
                elements.nextBtn.disabled = !isAnswered;
            }
            
            // Update next button text
            if (surveyState.currentQuestionIndex < module.questions.length - 1) {
                elements.nextBtn.innerHTML = 'Next Question <i class="fas fa-arrow-right"></i>';
            } else {
                elements.nextBtn.innerHTML = 'Next Module <i class="fas fa-forward"></i>';
            }
        }

        // Show completion screen
        function showCompletionScreen() {
            const totalAnswered = Object.values(surveyState.answers).reduce((sum, moduleAnswers) => {
                return sum + Object.keys(moduleAnswers).length;
            }, 0);
            
            const totalQuestions = surveyData.reduce((sum, module) => sum + module.questions.length, 0);
            
            elements.questionsContainer.innerHTML = `
                <div class="completion-screen">
                    <div class="completion-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>Survey Complete! ðŸŽ‰</h2>
                    <p>Thank you for providing valuable feedback on ieHRMS. All your responses have been saved.</p>
                    
                    <div class="submission-details">
                        <h3><i class="fas fa-chart-bar"></i> Submission Summary</h3>
                        <div class="detail-item">
                            <span class="detail-label">Total Questions:</span>
                            <span class="detail-value">${totalQuestions}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Questions Answered:</span>
                            <span class="detail-value">${totalAnswered}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Modules Completed:</span>
                            <span class="detail-value">${surveyData.length}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Storage:</span>
                            <span class="detail-value">${surveyState.useLocalStorage ? 'Local Storage' : 'Database'}</span>
                        </div>
                    </div>
                    
                    <p style="margin-top: 30px; font-size: 1.1rem; color: #48bb78;">
                        <i class="fas fa-check-circle"></i> Your feedback has been successfully recorded.
                    </p>
                </div>
            `;
            
            elements.navigationButtons.style.display = 'none';
        }

        // Update overall progress
        function updateProgress() {
            let totalAnswered = 0;
            let totalQuestions = 0;
            
            surveyData.forEach(module => {
                totalQuestions += module.questions.length;
                totalAnswered += Object.keys(surveyState.answers[module.id] || {}).length;
            });
            
            const progressPercent = Math.round((totalAnswered / totalQuestions) * 100);
            
            elements.overallProgressBar.style.width = `${progressPercent}%`;
            elements.progressText.textContent = `${progressPercent}% Complete`;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Start survey button - FIXED
            if (elements.startSurveyBtn) {
                elements.startSurveyBtn.addEventListener('click', startSurvey);
            }
            
            // Navigation buttons
            if (elements.prevBtn) {
                elements.prevBtn.addEventListener('click', () => {
                    goToPreviousQuestion();
                });
            }
            
            if (elements.nextBtn) {
                elements.nextBtn.addEventListener('click', () => {
                    goToNextQuestion();
                });
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initSurvey);
    </script>
</body>
</html>